<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RSC Explorer Embeds</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      h2 {
        margin-top: 40px;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
      }
      .embed-container {
        height: 500px;
        margin-bottom: 40px;
      }
    </style>
  </head>
  <body>
    <h1>RSC Explorer Embeds</h1>
    <p>Multiple embedded RSC explorers demonstrating different React Server Components patterns.</p>

    <h2>Hello World</h2>
    <p>The simplest possible server component.</p>
    <div id="hello" class="embed-container"></div>

    <h2>Counter</h2>
    <p>A client component with state, rendered from a server component.</p>
    <div id="counter" class="embed-container"></div>

    <h2>Async Component</h2>
    <p>Server components can be async and use Suspense for loading states.</p>
    <div id="async" class="embed-container"></div>

    <h2>Form Action</h2>
    <p>Server actions handle form submissions with useActionState.</p>
    <div id="form" class="embed-container"></div>
  </body>

  <script type="module">
    import { mount } from "http://localhost:3333/embed.js";

    mount("#hello", {
      server: `export default function App() {
  return <h1>Hello World</h1>
}`,
      client: `'use client'`,
    });

    mount("#counter", {
      server: `import { Counter } from './client'

export default function App() {
  return (
    <div>
      <h1>Counter</h1>
      <Counter initialCount={0} />
    </div>
  )
}`,
      client: `'use client'

import { useState } from 'react'

export function Counter({ initialCount }) {
  const [count, setCount] = useState(initialCount)

  return (
    <div>
      <p>Count: {count}</p>
      <div style={{ display: 'flex', gap: 8 }}>
        <button onClick={() => setCount(c => c - 1)}>âˆ’</button>
        <button onClick={() => setCount(c => c + 1)}>+</button>
      </div>
    </div>
  )
}`,
    });

    mount("#async", {
      server: `import { Suspense } from 'react'

export default function App() {
  return (
    <div>
      <h1>Async Component</h1>
      <Suspense fallback={<p>Loading...</p>}>
        <SlowComponent />
      </Suspense>
    </div>
  )
}

async function SlowComponent() {
  await new Promise(r => setTimeout(r, 500))
  return <p>Data loaded!</p>
}`,
      client: `'use client'`,
    });

    mount("#form", {
      server: `import { Form } from './client'

export default function App() {
  return (
    <div>
      <h1>Form Action</h1>
      <Form greetAction={greet} />
    </div>
  )
}

async function greet(prevState, formData) {
  'use server'
  await new Promise(r => setTimeout(r, 500))
  const name = formData.get('name')
  if (!name) return { message: null, error: 'Please enter a name' }
  return { message: \`Hello, \${name}!\`, error: null }
}`,
      client: `'use client'

import { useActionState } from 'react'

export function Form({ greetAction }) {
  const [state, formAction, isPending] = useActionState(greetAction, {
    message: null,
    error: null
  })

  return (
    <form action={formAction}>
      <div style={{ display: 'flex', gap: 8 }}>
        <input
          name="name"
          placeholder="Enter your name"
          style={{ padding: '8px 12px', borderRadius: 4, border: '1px solid #ccc' }}
        />
        <button disabled={isPending}>
          {isPending ? 'Sending...' : 'Greet'}
        </button>
      </div>
      {state.error && <p style={{ color: 'red', marginTop: 8 }}>{state.error}</p>}
      {state.message && <p style={{ color: 'green', marginTop: 8 }}>{state.message}</p>}
    </form>
  )
}`,
    });
  </script>

  <div id="rsc-explorer" style="height: 500px"></div>
  <script type="module">
    import { mount } from 'https://rscexplorer.dev/embed.js';

    mount('#rsc-explorer', {
      server: `
    import { Suspense } from 'react'
    import { Timer, Router } from './client'

    export default function App() {
      return (
        <div>
          <h1>Router Refresh!!!</h1>
          <p style={{ marginBottom: 12, color: '#666' }}>
            Client state persists across server navigations
          </p>
          <Suspense fallback={<p>Loading...</p>}>
            <Router initial={renderPage()} refreshAction={renderPage} />
          </Suspense>
        </div>
      )
    }

    async function renderPage() {
      'use server'
      return <ColorTimer />
    }

    async function ColorTimer() {
      await new Promise(r => setTimeout(r, 300))
      const hue = Math.floor(Math.random() * 360)
      return <Timer color={`hsl(${hue}, 70%, 85%)`} />
    }
      `,
      client: `
    'use client'

    import { useState, useEffect, useTransition, use } from 'react'

    export function Timer({ color }) {
      const [seconds, setSeconds] = useState(0)

      useEffect(() => {
        const id = setInterval(() => setSeconds(s => s + 1), 1000)
        return () => clearInterval(id)
      }, [])

      return (
        <div style={{
          background: color,
          padding: 24,
          borderRadius: 8,
          textAlign: 'center'
        }}>
          <p style={{ fontFamily: 'monospace', fontSize: 32, margin: 0 }}>{seconds}s</p>
        </div>
      )
    }

    export function Router({ initial, refreshAction }) {
      const [contentPromise, setContentPromise] = useState(initial)
      const [isPending, startTransition] = useTransition()
      const content = use(contentPromise)

      const refresh = () => {
        startTransition(() => {
          setContentPromise(refreshAction())
        })
      }

      return (
        <div style={{ opacity: isPending ? 0.6 : 1, transition: 'opacity 0.2s' }}>
          {content}
          <button onClick={refresh} disabled={isPending} style={{ marginTop: 12 }}>
            {isPending ? 'Refreshing...' : 'Refresh'}
          </button>
        </div>
      )
    }
      `
    });
  </script>
</html>
